### **Partie 0 : Initialisation et Pré-requis**

#### **0.1. Préparation de l'environnement**

Avant de commencer, assurez-vous que les outils suivants sont installés et fonctionnels sur votre machine. **Ce projet est pensé uniquement pour un environnement de test / laboratoire local (pas de production).**

*   **Git :** Pour la gestion de version.
*   **Docker :** Pour la conteneurisation.
*   **Docker Compose (V2) :** L'outil d'orchestration.

Vous pouvez vérifier leurs versions avec les commandes suivantes dans votre terminal :
```bash
docker --version
docker compose version
```
*(Note : Assurez-vous d'utiliser `docker compose` et non l'ancienne version `docker-compose` avec un tiret).*

Pour une meilleure expérience, je vous recommande d'installer l'extension **Docker** pour VSCode.

#### **0.2. Structure du projet**

Nous allons maintenant créer l'arborescence des dossiers et les fichiers de base. Ouvrez votre terminal, placez-vous dans le répertoire où vous souhaitez créer votre projet, et exécutez les commandes adaptées à votre système.

Si vous travaillez sur Linux/macOS ou WSL (bash/zsh) :

```bash
# Crée le dossier principal du projet et s'y déplace
mkdir it-stack-project && cd it-stack-project

# Crée un dossier par service pour organiser les configurations
mkdir -p nginx openldap snipe-it zammad

# Crée les fichiers vides que nous allons remplir
touch docker-compose.yml .env.example README.md
```

Si vous travaillez sur Windows PowerShell (PowerShell v5.1 ou plus) :

```powershell
# Crée le dossier principal du projet et s'y déplace
New-Item -ItemType Directory -Path it-stack-project -Force | Out-Null
Set-Location it-stack-project

# Crée un dossier par service pour organiser les configurations
New-Item -ItemType Directory -Path nginx,openldap,'snipe-it',zammad -Force | Out-Null

# Crée les fichiers vides que nous allons remplir
New-Item -ItemType File -Path docker-compose.yml -Force | Out-Null
New-Item -ItemType File -Path .env.example -Force | Out-Null
New-Item -ItemType File -Path README.md -Force | Out-Null
```

Après avoir exécuté les commandes ci‑dessus, votre projet devrait avoir la structure suivante :

```
it-stack-project/
├── nginx/
├── openldap/
├── snipe-it/
├── zammad/
├── .env.example
├── docker-compose.yml
└── README.md
```

#### **0.3. Définition de la configuration centrale (`.env`)**

Le fichier `.env` contiendra toutes nos variables de configuration (mots de passe, noms de domaine, etc.). Cela nous permet de ne pas les écrire en dur dans notre `docker-compose.yml`. **Dans ce projet de lab, ces valeurs sont considérées comme jetables et ne doivent jamais être réutilisées en production.**

**Important — création du fichier `.env` :**

Avant de démarrer les services, créez le fichier `.env` en copiant `.env.example`. Si `.env` est absent, Docker Compose peut laisser des variables (ex: `TZ`) vides et afficher des avertissements.

- Sous Linux/macOS/WSL (bash) :

```bash
cp .env.example .env
```

- Sous Windows PowerShell :

```powershell
Copy-Item -Path .env.example -Destination .env -Force
```


1.  **Copiez le contenu suivant dans votre fichier `.env.example`**. Ce fichier servira de modèle pour la configuration.

    ```ini
    #================================================================
    # GLOBAL CONFIGURATION
    #================================================================
    # Le domaine principal pour tous les services
    DOMAIN=projet.lan
    # Timezone pour tous les conteneurs
    TZ=Europe/Paris
    # User and Group ID pour la gestion des permissions.
    # Sur Linux/macOS, trouvez les vôtres avec la commande `id -u` et `id -g`
    PUID=1000
    PGID=1000

    #================================================================
    # OPENLDAP CONFIGURATION
    #================================================================
    # Le mot de passe pour l'administrateur LDAP (cn=admin,dc=projet,dc=lan)
    LDAP_ROOT_PASSWORD=YourStrongLdapPassword

    #================================================================
    # ZAMMAD (POSTGRES) CONFIGURATION
    #================================================================
    POSTGRES_USER=zammad
    POSTGRES_PASSWORD=YourStrongZammadDbPassword
    POSTGRES_DB=zammad_production

    #================================================================
    # SNIPE-IT (MARIADB) CONFIGURATION
    #================================================================
    MYSQL_ROOT_PASSWORD=YourStrongSnipeRootDbPassword
    MYSQL_DATABASE=snipeit
    MYSQL_USER=snipeit
    MYSQL_PASSWORD=YourStrongSnipeDbPassword
    # Cette clé sera générée plus tard, laissez-la vide pour l'instant
    SNIPEIT_APP_KEY=
    ```

2.  **Créez votre fichier de configuration personnel** en copiant le modèle. Ce fichier `.env` est ignoré par Git et ne doit jamais être partagé.

    - Sous Linux/macOS/WSL (bash) :

    ```bash
    cp .env.example .env
    ```

    - Sous Windows PowerShell :

    ```powershell
    Copy-Item -Path .env.example -Destination .env -Force
    ```

3.  **Modifiez le fichier `.env`** et remplacez toutes les valeurs "placeholder" (comme `YourStrong...Password`) par des mots de passe robustes de votre choix.

#### **0.4. Création du réseau Docker commun**

Pour que nos conteneurs puissent communiquer entre eux en utilisant leur nom de service (ex: `zammad` pourra joindre `openldap`), nous devons les placer sur un réseau commun.

Modifiez votre fichier **`docker-compose.yml`** et ajoutez-y le contenu suivant :

```yaml
version: '3.8'

networks:
  it_stack_net:
    driver: bridge
```

Cela ne fait que définir un réseau nommé `it_stack_net`. Plus tard, nous indiquerons à chaque service de se connecter à ce réseau.